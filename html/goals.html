<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Objectifs - NutriSport</title>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-dumbbell"></i> NutriSport
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="mainNav">
                    <!-- Navigation items will be loaded dynamically -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Goals Section -->
    <section class="py-5">
        <div class="container">
            <div class="text-center mb-5">
                <i class="fas fa-bullseye fa-3x text-primary"></i>
                <h1 class="mt-3">Mes Objectifs de Transformation</h1>
                <p class="lead text-muted">Calculez vos besoins et définissez des objectifs réalistes</p>
            </div>

            <div class="row">
                <!-- Profile Calculator & Current Status -->
                <div class="col-lg-4">
                    <!-- Profile Info Form -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title text-center mb-4">
                                <i class="fas fa-user-circle text-primary"></i> Mon Profil
                            </h5>
                            <form id="profileForm">
                                <div class="mb-3">
                                    <label class="form-label">Sexe</label>
                                    <select class="form-select" id="gender" required>
                                        <option value="">Sélectionner...</option>
                                        <option value="male">Homme</option>
                                        <option value="female">Femme</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Âge (ans)</label>
                                    <input type="number" class="form-control" id="age" min="15" max="100" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Taille (cm)</label>
                                    <input type="number" class="form-control" id="height" min="100" max="250" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Poids Actuel (kg)</label>
                                    <input type="number" class="form-control" id="currentWeight" step="0.1" min="30" max="300" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Niveau d'Activité</label>
                                    <select class="form-select" id="activityLevel" required>
                                        <option value="">Sélectionner...</option>
                                        <option value="1.2">Sédentaire (peu ou pas d'exercice)</option>
                                        <option value="1.375">Légèrement actif (1-3 jours/sem)</option>
                                        <option value="1.55">Modérément actif (3-5 jours/sem)</option>
                                        <option value="1.725">Très actif (6-7 jours/sem)</option>
                                        <option value="1.9">Extrêmement actif (2x/jour)</option>
                                    </select>
                                </div>
                                <div class="text-center mb-3" id="currentBMIDisplay" style="display:none;">
                                    <h4 id="currentBMI" class="text-primary mb-0">--</h4>
                                    <small class="text-muted">IMC actuel</small>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Goal Setting -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-flag-checkered text-success"></i> Mon Objectif
                            </h5>
                            <form id="goalForm">
                                <div class="mb-3">
                                    <label class="form-label">Poids Cible (kg)</label>
                                    <input type="number" class="form-control" id="targetWeight" step="0.1" min="30" max="300" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Durée souhaitée (jours)</label>
                                    <input type="number" class="form-control" id="targetDuration" min="1" max="365" placeholder="Ex: 30, 60, 90..." required>
                                </div>
                                <div id="validationMessage" class="alert d-none"></div>
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-calculator"></i> Calculer & Valider
                                </button>
                            </form>
                            
                            <!-- Scientific Info -->
                            <div class="mt-4 p-3 bg-light rounded">
                                <h6><i class="fas fa-microscope text-primary"></i> Base Scientifique</h6>
                                <small class="text-muted">
                                    <strong>Formules utilisées :</strong><br>
                                    • BMR : Équation Mifflin-St Jeor (1990)<br>
                                    • 1 kg de graisse = 7700 kcal (consensus)<br>
                                    <strong>Limites de sécurité :</strong><br>
                                    • Perte max : 1% du poids/semaine (ACSM)<br>
                                    • Déficit max : 1000 kcal/jour (NIH)<br>
                                    • Calories min ♂ : 1500 kcal | ♀ : 1200 kcal<br>
                                    • Prise masse max : 0.5 kg/semaine
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Tracking & Results -->
                <div class="col-lg-8">
                    <!-- Nutritional Requirements Card -->
                    <div class="card shadow-sm mb-4" id="resultsCard" style="display:none;">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-chart-pie text-primary"></i> Vos Besoins Nutritionnels
                            </h5>
                            
                            <!-- Calorie Needs -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="text-center p-4 bg-light rounded">
                                        <h3 id="bmrValue" class="text-primary mb-1">--</h3>
                                        <p class="mb-0 text-muted">Métabolisme de Base (BMR)</p>
                                        <small class="text-muted">Calories au repos</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center p-4 bg-primary bg-opacity-10 rounded">
                                        <h3 id="tdeeValue" class="text-primary mb-1">--</h3>
                                        <p class="mb-0 fw-bold">Calories Quotidiennes</p>
                                        <small class="text-muted">Pour atteindre votre objectif</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Macros Breakdown -->
                            <h6 class="mb-3"><i class="fas fa-balance-scale"></i> Répartition des Macronutriments</h6>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="card bg-danger bg-opacity-10">
                                        <div class="card-body text-center">
                                            <i class="fas fa-drumstick-bite fa-2x text-danger mb-2"></i>
                                            <h4 id="proteinGrams" class="text-danger mb-0">-- g</h4>
                                            <p class="mb-1 small">Protéines</p>
                                            <small id="proteinCalories" class="text-muted">-- kcal</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-warning bg-opacity-10">
                                        <div class="card-body text-center">
                                            <i class="fas fa-bread-slice fa-2x text-warning mb-2"></i>
                                            <h4 id="carbsGrams" class="text-warning mb-0">-- g</h4>
                                            <p class="mb-1 small">Glucides</p>
                                            <small id="carbsCalories" class="text-muted">-- kcal</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-info bg-opacity-10">
                                        <div class="card-body text-center">
                                            <i class="fas fa-cheese fa-2x text-info mb-2"></i>
                                            <h4 id="fatsGrams" class="text-info mb-0">-- g</h4>
                                            <p class="mb-1 small">Lipides</p>
                                            <small id="fatsCalories" class="text-muted">-- kcal</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Goal Timeline -->
                            <div class="mt-4 p-3 bg-light rounded">
                                <h6><i class="fas fa-clock"></i> Calendrier de l'Objectif</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Poids à perdre/gagner:</strong> <span id="weightDifference">--</span> kg</p>
                                        <p class="mb-1"><strong>Durée:</strong> <span id="timelineDays">--</span> jours</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Perte/Gain par semaine:</strong> <span id="weeklyChange">--</span> kg</p>
                                        <p class="mb-1"><strong>Date d'atteinte:</strong> <span id="targetDateDisplay">--</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Summary -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-chart-line text-info"></i> Progression vers l'Objectif
                            </h5>
                            <div id="goalSummary" class="text-center py-5">
                                <i class="fas fa-target fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Aucun objectif défini. Créez votre premier objectif pour commencer !</p>
                            </div>
                        </div>
                    </div>

                    <!-- Weight History Chart -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-chart-area text-primary"></i> Historique du Poids
                            </h5>
                            <canvas id="weightChart" height="100"></canvas>
                        </div>
                    </div>

                    <!-- Weight History Table -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-history text-secondary"></i> Historique des Pesées
                            </h5>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Poids (kg)</th>
                                            <th>IMC</th>
                                            <th>Variation</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="weightHistoryTable">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted">
                                                Aucune pesée enregistrée
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Motivational Stats -->
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="card shadow-sm text-center">
                        <div class="card-body">
                            <i class="fas fa-fire fa-2x text-danger mb-2"></i>
                            <h3 id="daysStreak" class="mb-0">0</h3>
                            <small class="text-muted">Jours consécutifs</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm text-center">
                        <div class="card-body">
                            <i class="fas fa-weight fa-2x text-success mb-2"></i>
                            <h3 id="totalLoss" class="mb-0">0 kg</h3>
                            <small class="text-muted">Perte/Gain total</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm text-center">
                        <div class="card-body">
                            <i class="fas fa-calendar-check fa-2x text-info mb-2"></i>
                            <h3 id="totalDays" class="mb-0">0</h3>
                            <small class="text-muted">Jours de suivi</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm text-center">
                        <div class="card-body">
                            <i class="fas fa-percentage fa-2x text-warning mb-2"></i>
                            <h3 id="progressPercent" class="mb-0">0%</h3>
                            <small class="text-muted">Progression</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Update Weight Modal -->
    <div class="modal fade" id="updateWeightModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-weight"></i> Mettre à jour le Poids
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="updateWeightForm">
                        <div class="mb-3">
                            <label class="form-label">Date de la pesée</label>
                            <input type="date" class="form-control" id="weighInDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Poids (kg)</label>
                            <input type="number" class="form-control" id="weighInWeight" step="0.1" min="30" max="300" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes (optionnel)</label>
                            <textarea class="form-control" id="weighInNotes" rows="2" placeholder="Ex: Après entraînement..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="saveWeighIn()">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2025 NutriSport. Tous droits réservés.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/goals.js"></script>
    <script src="../js/pwa.js"></script>
</body>
</html>
